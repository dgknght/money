%table.register{ cellspacing: 0, cellpadding: 0, data: { bind: "visible: transactionItemsVisible, attr: {id: 'transactions_' + id() }" }}
  %tr
    %th.number_column Date
    %th Description
    %th Account
    %th.boolean_column Rec.
    %th.number_column Amount
    %th.number_column Balance
    %th &nbsp;

  =render 'pages/app/transaction_item_form'

  <!-- ko foreach: transaction_items -->
  %tr.attachment_drop{ data: { bind: "attr: {'data-id': id}, css: $index() % 2 == 0 ? 'table_row' : 'alt_table_row'" }}
    %td.number_column{ data: { bind: "inlineDateEditor: formattedTransactionDate, editorClass: 'date_field'" }}
    %td{ data: { bind: "inlineEditor: description" }}
    %td
      %span.ui-icon.account-toggle{ data: { bind: "click: toggleDetails, css: toggleCss" }} &nbsp;
      %span{ data: { bind: "inlineEditor: otherAccountPath, editorClass: 'account_field', autocompleteLookup: getAccountPaths" }}
    %td.boolean_column{ data: { bind: "text: reconciled() ? 'X' : ''" }}
    %td.number_column{ data: { bind: "inlineEditor: formattedPolarizedAmount, editorClass: 'number_field'" }}
      %span.validation_message{ data: { bind: "visible: polarizedAmount.hasError, text: polarizedAmount.errorMessage" }}
    %td.number_column{ data: { bind: "text: formattedBalance" }}
    %td.action_cell
      %a.small_delete_button{ href: '#', title: 'Click here to delete this transaction.', data: { bind: "click: destroy" }} Delete
      %a.small_attachments_button{ href: '#', title: 'Click here to show or hide the attachment.', data: { bind: "click: toggleAttachmentsVisible" }}
      =render 'pages/app/attachments'

  %tr{ data: { bind: "if: showDetails" }}
    %td.detail_cell{ colspan: 6, data: { bind: "with: transaction" }} 
      %table.detail{cellpadding: 0, cellspacing: 0}
        %tr
          %th Account
          %th Memo
          %th Confirmation
          %th.number_column Debit
          %th.number_column Credit
          %th &nbsp;
        <!-- ko foreach: items-->
        %tr
          %td
            %input{ type: 'text', data: { bind: "autocomplete: accountPath, source: getAccountPaths" }}
          %td
            %input{ type: 'text', data: { bind: "value: memo" }}
          %td
            %input{ type: 'text', data: { bind: "value: confirmation" }}
          %td.number_column
            %input.number_field{ type: 'text', data: { bind: "value: formattedDebitAmount" }}
          %td.number_column
            %input.number_field{ type: 'text', data: { bind: "value: formattedCreditAmount" }}
          %td.action_cell
            %a.small_delete_button{ href: '#', title: 'Click here to delete this item.', data: { bind: "click: remove" }}
        <!-- /ko -->
        %tr
          %td
            %a.small_add_button{ href: '#', data: { bind: "click: addTransactionItem" }} Add
          %td.number_column{ data: { bind: "text: formattedDebitAmount" }}
          %td.number_column{ data: { bind: "text: formattedCreditAmount" }}
          %td &nbsp;
    %td{ data: { bind: "with: transaction" }}
      %button.small_save_button{ data: { bind: "click: save" }, title: 'Click here to save the transaction.'}
        Save
  <!-- /ko -->
